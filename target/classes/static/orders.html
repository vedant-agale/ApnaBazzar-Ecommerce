<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>My Orders - Apna Bazaar</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f0f2f5; padding: 20px; margin: 0; }
        .navbar { background-color: #2874f0; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; color: white; margin-bottom: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 0 15px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #2874f0; margin-bottom: 30px; }
        
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #f8f9fa; color: #212121; font-weight: 600; }
        
        .badge { padding: 6px 12px; border-radius: 4px; font-size: 12px; font-weight: bold; text-transform: uppercase; }
        .success { background-color: #388e3c; color: white; }
        
        .btn-back { 
            text-decoration: none; 
            background-color: #2874f0; 
            color: white; 
            padding: 10px 20px; 
            border-radius: 2px;
            font-weight: 500; 
            font-size: 14px;
        }
        .btn-back:hover { background-color: #1a5fc7; }
        .empty-orders { text-align: center; padding: 40px; }
    </style>
</head>
<body>

    <div class="navbar">
        <div style="font-size: 20px; font-weight: bold;">üõí Apna Bazaar</div>
        <a href="shop.html" class="btn-back">‚¨Ö Back to Shop</a>
    </div>

    <div class="container">
        <h1>üìú My Order History</h1>
        
        <table id="ordersTable">
            <thead>
                <tr>
                    <th>Order ID</th>
                    <th>Date & Time</th>
                    <th>Total Amount</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="ordersBody">
                </tbody>
        </table>
        <div id="noOrders" class="empty-orders" style="display: none;">
            <h3>Aapne abhi tak koi order nahi kiya hai! ‚òπÔ∏è</h3>
            <a href="shop.html" style="color: #2874f0;">Shopping shuru karein</a>
        </div>
    </div>

    <script>
        // --- 1. GET DYNAMIC USER FROM STORAGE ---
        const userJson = localStorage.getItem("loggedInUser");
        if (!userJson) {
            window.location.href = "login.html";
        }
        const currentUser = JSON.parse(userJson);
        const username = currentUser.username;

        // --- 2. LOAD ORDERS FROM BACKEND ---
        async function loadOrders() {
            try {
                // Controller URL: /api/orders/{name}
                const response = await fetch(`http://localhost:8080/api/orders/${username}`);
                const orders = await response.json();
                
                const tableBody = document.getElementById("ordersBody");
                const tableElement = document.getElementById("ordersTable");
                const noOrdersDiv = document.getElementById("noOrders");

                if (orders.length === 0) {
                    tableElement.style.display = "none";
                    noOrdersDiv.style.display = "block";
                    return;
                }

                let html = "";
                orders.forEach(order => {
                    // Date display fix (Based on String format from backend)
                    const dateDisplay = order.orderDate ? order.orderDate.split('T')[0] : "N/A";

                    html += `
                    <tr>
                        <td style="font-weight: bold; color: #2874f0;">#${order.id}</td>
                        <td>${dateDisplay}</td>
                        <td style="font-weight: bold;">‚Çπ${order.totalAmount || order.price}</td>
                        <td><span class="badge success">${order.status || 'SUCCESS'}</span></td>
                    </tr>`;
                });

                tableBody.innerHTML = html;
            } catch (error) {
                console.error('Error:', error);
                document.getElementById("ordersBody").innerHTML = "<tr><td colspan='4' style='text-align:center; color:red;'>Server connectivity issue!</td></tr>";
            }
        }

        loadOrders();
    </script>

</body>
</html>